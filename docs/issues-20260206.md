# Issues Found During Testing - 2026-02-06

Log directory: `/logs/libpng_2c34a678_20260206_063235/`

## Issue 1: Two SeedAgents Generated 0 Seeds

**Files**:
- `Seed_1_PNG Chunk Parsing an.log` - Seeds Generated: 0
- `Seed_4_Interlace Handling a.log` - Seeds Generated: 0

**Symptoms**:
- 12 iterations, 18-19 tool calls
- Duration: ~120s
- But no seeds created

**Root Cause**:
All 5 parallel SeedAgents used the **same** `worker_id` as context key, causing collision:
- Agent A sets context with `worker_id="worker_xxx"`
- Agent B overwrites context with same `worker_id`
- Agent A finishes and clears context
- Agent C tries to use context → FAILED (already cleared)

**Fix**: Commit `011595224` - Each SeedAgent uses unique `_context_id`:
- Add `mcp_context_id` property to BaseAgent (default: worker_id)
- SeedAgent generates `_context_id = f"{worker_id}_{id(self)}"`
- Use `_context_id` for context key, keeping `worker_id` unchanged

**Status**: FIXED

---

## Issue 2: Budget Exceeded Should Show "Completed" Not "Failed"

**File**: POV agent log

**Current Behavior**:
```
│  ❌ FAILED - No crash achieved                                        │
```

**Expected Behavior**:
- When budget is exceeded, it's a normal termination
- Should show "COMPLETED (Budget Limit Reached)" or similar
- Not a failure

**Fix**: Commit `652d7f650`
- Add `stop_reason` field to BaseAgent (None, "budget", "timeout", "error")
- POV agent summary shows:
  - `✅ SUCCESS - Crash triggered!` - found vulnerability
  - `⏹️ COMPLETED - No crash found` - normal completion (not a failure)
  - `⏹️ COMPLETED (Budget Limit Reached)` - budget exceeded
  - `⏹️ COMPLETED (Time Limit Reached)` - timeout
  - `❌ FAILED - Error occurred` - only for actual errors

**Status**: FIXED

---

## Issue 3: SPG_0.log Shows No SPs Created, But SPV Agents Exist

**File**: `agent/sp/generate/SPG_0.log`

**Root Cause**:
- FunctionAnalysisAgent wasn't passing index/target_name/fuzzer/sanitizer to base class
- This caused fallback to legacy logging path
- Each function should have its own log file: `SPG_{index}_{function_name}.log`

**Fix**:
- Updated FunctionAnalysisAgent to pass index, target_name, fuzzer, sanitizer to base class
- Updated LargeFunctionAnalysisAgent similarly
- Updated callers in pov_fullscan.py and pov_strategy.py to pass index

**Status**: FIXED

---

## Issue 4: Unknown File `69858baa89fd4d767dfa398e-functioncheck.log`

**File**: `agent/69858baa89fd4d767dfa398e-functioncheck.log`

**Root Cause**:
- `_write_function_log` and `_write_function_log_v2` methods in pov_strategy.py and pov_fullscan.py
- These created combined log files using direction_id as filename
- Redundant with individual agent logs

**Fix**:
- Removed `_write_function_log` from pov_strategy.py
- Removed `_write_function_log_v2` from pov_fullscan.py
- Removed `_direction_log_locks` initialization
- Added timestamp conflict handling to `get_agent_log_path` in logging.py

**Status**: FIXED

---

## Issue 5: Summary显示Cost为$0.05而非实际值

**Symptoms**:
- Summary显示 `API Cost: $0.05` 但实际花费了 $13+

**Root Cause**:
- task_processor.py调用了错误的API endpoint
- 调用: `/api/tasks/{task_id}`
- 正确: `/api/v1/costs/task/{task_id}`

**Fix**: Commit `0a7168396`
- 修正API endpoint路径

**Status**: FIXED

---

## Issue 6: 有POV但Worker显示Failed

**Symptoms**:
- Worker找到了4个POV
- 但Summary显示 `0/1 completed, 1 failed`

**Root Cause**:
- Timeout时Celery强制终止worker
- `result.failed()` 返回True
- Worker被标记为failed，尽管已有成果

**Fix**: Commit `0a7168396`
- 新增 "interrupted" 状态
- 有结果(SPs或POVs)但被杀的worker显示为 `⚡ interrupted`

**Status**: FIXED

---

## Issue 7: Worker在Timeout前5分钟被杀

**Symptoms**:
- 设置10分钟timeout
- Worker在5分钟时被 `SoftTimeLimitExceeded` 杀掉

**Root Cause**:
- Celery soft_timeout公式: `max(timeout - 300, timeout // 2)`
- 10分钟: `max(600-300, 300) = 300秒 = 5分钟`
- Worker只能运行50%的分配时间

**Fix**: Commit `6a84e696c`
- 改为: `soft_timeout = int(timeout * 0.9)`
- 90%时间工作，10%用于graceful shutdown

**Status**: FIXED

---

## Summary

| # | Issue | Priority | Status |
|---|-------|----------|--------|
| 1 | SeedAgent 0 seeds (parallel context collision) | Medium | FIXED (011595224) |
| 2 | Budget exceeded status | Low | FIXED (652d7f650) |
| 3 | SPG/SPV inconsistency - wrong log paths | High | FIXED (597a645a0) |
| 4 | Unknown combined log file | Medium | FIXED (597a645a0) |
| 5 | Cost显示$0.05错误 | High | FIXED (0a7168396) |
| 6 | 有POV但显示Failed | Medium | FIXED (0a7168396) |
| 7 | Soft timeout过早杀worker | Critical | FIXED (6a84e696c) |
